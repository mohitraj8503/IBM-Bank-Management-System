#include <iostream>
#include <vector>
#include <fstream>
#include <iomanip>
#include <ctime>
#include <string>
#include <limits>
#include <algorithm>
using namespace std;

// Transaction structure
struct Transaction {
    string type;
    double amount;
    string date;
    Transaction(string t, double a) : type(t), amount(a) {
        time_t now = time(0);
        tm* ltm = localtime(&now);
        char buf[20];
        strftime(buf, sizeof(buf), "%Y-%m-%d %H:%M", ltm);
        date = buf;
    }
};

// Account class with PROPER getters/setters
class BankAccount {
private:
    int accountNo;
    string name;
    string password;
    string type;
    double balance;
    vector<Transaction> transactions;

public:
    BankAccount() : accountNo(0), balance(0) {}
    
    BankAccount(int no, string n, string pass, string t, double b) 
        : accountNo(no), name(n), password(pass), type(t), balance(b) {}

    // GETTERS
    int getNo() const { return accountNo; }
    string getName() const { return name; }
    string getType() const { return type; }
    double getBalance() const { return balance; }
    const vector<Transaction>& getTransactions() const { return transactions; }
    bool authenticate(const string& pass) const { return password == pass; }

    // SETTERS
    void setAccountNo(int no) { accountNo = no; }
    void setName(const string& n) { name = n; }
    void setPassword(const string& pass) { password = pass; }
    void setType(const string& t) { type = t; }
    void setBalance(double b) { balance = b; }

    // Core banking operations
    bool deposit(double amount) {
        if (amount <= 0) return false;
        balance += amount;
        transactions.push_back(Transaction("DEPOSIT", amount));
        return true;
    }

    bool withdraw(double amount) {
        if (amount <= 0 || amount > balance) return false;
        balance -= amount;
        transactions.push_back(Transaction("WITHDRAWAL", -amount));
        return true;
    }

    void addInterest(double rate) {
        double interest = balance * (rate / 100);
        balance += interest;
        transactions.push_back(Transaction("INTEREST", interest));
    }

    // Display functions
    void showDetails() const {
        cout << "\n=== ACCOUNT DETAILS ===" << endl;
        cout << "Account No: " << accountNo << endl;
        cout << "Name: " << name << endl;
        cout << "Type: " << type << endl;
        cout << "Balance: Rs. " << fixed << setprecision(2) << balance << endl;
    }

    void showTransactions(int limit = 10) const {
        if (transactions.empty()) {
            cout << "No transactions yet." << endl;
            return;
        }
        cout << "\n=== LAST " << limit << " TRANSACTIONS ===" << endl;
        int count = 0;
        for (auto it = transactions.rbegin(); it != transactions.rend() && count < limit; ++it, ++count) {
            cout << it->date << " | " << it->type << " | Rs. " 
                 << fixed << setprecision(2) << it->amount << endl;
        }
    }
};

// âœ… FIXED PRESENTATION SCREEN - NO THREADING!
void showPresentation() {
    cout << "\n";
    cout << "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—" << endl;
    cout << "â•‘                                                                      â•‘" << endl;
    cout << "â•‘    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—  â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—         â•‘" << endl;
    cout << "â•‘    â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•         â•‘" << endl;
    cout << "â•‘    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â• â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—           â•‘" << endl;
    cout << "â•‘    â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•— â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•           â•‘" << endl;
    cout << "â•‘    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—         â•‘" << endl;
    cout << "â•‘    â•šâ•â•â•â•â•â• â•šâ•â•  â•šâ•â•â•šâ•â•  â•šâ•â•â•šâ•â•  â•šâ•â•â•šâ•â•  â•šâ•â•â•šâ•â•  â•šâ•â•â•â•â•šâ•â•â•â•â•â•â•         â•‘" << endl;
    cout << "â•‘                                                                      â•‘" << endl;
    cout << "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£" << endl;
    cout << "â•‘  ðŸŽ“ PRESENTED BY IBM STUDENTS OF ARKA JAIN UNIVERSITY ðŸŽ“              â•‘" << endl;
    cout << "â•‘                                                                      â•‘" << endl;
    cout << "â•‘  ðŸ‘¨â€ðŸŽ“ Mohit Raj              ðŸ‘©â€ðŸŽ“ Rishika Kumari          ðŸ‘©â€ðŸŽ“ G. Omkeshwari â•‘" << endl;
    cout << "â•‘     AJU/250609                    AJU/250878                    AJU/250193 â•‘" << endl;
    cout << "â•‘                                                                      â•‘" << endl;
    cout << "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£" << endl;
    cout << "â•‘  ðŸ“š SEMESTER - 1  |  ðŸ›ï¸ ARKA JAIN UNIVERSITY  |  ðŸ’» C++ OOP PROJECT     â•‘" << endl;
    cout << "â•‘                                                                      â•‘" << endl;
    cout << "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" << endl;
    cout << "\n";

    // âœ¨ Simple loading animation without threading
    cout << "ðŸŽ¯ Loading IBM Bank System";
    for (int i = 0; i < 3; i++) {
        cout << ".";
        cout.flush();
        for (volatile int j = 0; j < 1000000; j++); // Simple delay
    }
    cout << "\nðŸš€ IBM BANK MANAGEMENT SYSTEM v2.0 - READY! ðŸš€\n" << endl;
}

// Bank class (unchanged)
class Bank {
private:
    vector<BankAccount> accounts;
    int nextAccountNo;
    string adminUsername = "admin@ibmbank.in";
    string adminPassword = "ibm@24x7";

public:
    Bank() : nextAccountNo(1001) {
        createDemoAccounts();
        cout << "\nâœ… DEMO ACCOUNTS LOADED!" << endl;
        cout << "ðŸ‘¤ Customer: 212173314 / 1769" << endl;
        cout << "ðŸ‘¨â€ðŸ’¼ Admin: " << adminUsername << " / " << adminPassword << endl;
    }

    ~Bank() {
        saveAccounts();
    }

    void createDemoAccounts() {
        BankAccount demoCust(212173314, "Demo Customer", "1769", "Savings", 50000.00);
        accounts.push_back(demoCust);
        nextAccountNo = 212173315;

        BankAccount* demo = findAccount(212173314);
        if (demo) {
            demo->deposit(25000);
            demo->withdraw(5000);
        }
    }

    bool adminLogin(const string& username, const string& password) {
        return (username == adminUsername && password == adminPassword);
    }

    void createAccount() {
        BankAccount acc;
        string pass;
        
        cout << "\nðŸ‘¤ === NEW ACCOUNT CREATION ===" << endl;
        cout << "Enter customer FULL NAME: ";
        cin.ignore(numeric_limits<streamsize>::max(), '\n');
        getline(cin, pass);
        acc.setName(pass);
        
        cout << "ðŸ” Enter LOGIN PASSWORD for this customer: ";
        getline(cin, pass);
        acc.setPassword(pass);
        
        cout << "ðŸ¦ Account type (Savings/Current): ";
        getline(cin, pass);
        acc.setType(pass);
        
        double initial;
        cout << "ðŸ’° Initial deposit amount: Rs. ";
        while (!(cin >> initial) || initial < 0) {
            cout << "âŒ Invalid amount! Enter positive number: Rs. ";
            cin.clear();
            cin.ignore(numeric_limits<streamsize>::max(), '\n');
        }
        acc.setBalance(initial);

        acc.setAccountNo(nextAccountNo++);
        accounts.push_back(acc);
        
        cout << "\nâœ… ACCOUNT CREATED SUCCESSFULLY!" << endl;
        cout << "ðŸ‘¤ Name     : " << acc.getName() << endl;
        cout << "ðŸ“± Account No: " << acc.getNo() << endl;
        cout << "ðŸ” Login Password: " << pass << " (save this!)" << endl;
        cout << "ðŸ’° Balance  : Rs. " << fixed << setprecision(2) << acc.getBalance() << endl;
    }

    BankAccount* findAccount(int no) {
        for (auto& acc : accounts) {
            if (acc.getNo() == no) return &acc;
        }
        return nullptr;
    }

    void adminMenu() {
        int choice;
        do {
            cout << "\n=== ðŸ‘¨â€ðŸ’¼ ADMIN PANEL ===" << endl;
            cout << "1. Create Account" << endl;
            cout << "2. Delete Account" << endl;
            cout << "3. View All Accounts" << endl;
            cout << "4. Apply Interest (Savings)" << endl;
            cout << "0. Logout" << endl;
            cout << "Choice: ";
            cin >> choice;

            switch (choice) {
                case 1: createAccount(); break;
                case 2: deleteAccount(); break;
                case 3: listAllAccounts(); break;
                case 4: applyInterest(); break;
                case 0: cout << "ðŸ‘‹ Admin logged out!" << endl; break;
                default: cout << "âŒ Invalid choice!" << endl;
            }
        } while (choice != 0);
    }

    void customerMenu() {
        int accNo;
        string pass;
        
        cout << "\nðŸ” Enter Account No: ";
        cin >> accNo;
        cout << "ðŸ” Enter Password: ";
        cin.ignore();
        getline(cin, pass);

        BankAccount* acc = findAccount(accNo);
        if (!acc || !acc->authenticate(pass)) {
            cout << "âŒ Invalid credentials!" << endl;
            return;
        }

        int choice;
        do {
            cout << "\n=== ðŸ‘¤ CUSTOMER MENU (" << acc->getName() << ") ===" << endl;
            acc->showDetails();
            cout << "1. ðŸ’° Deposit" << endl;
            cout << "2. ðŸ’¸ Withdraw" << endl;
            cout << "3. ðŸ”„ Transfer" << endl;
            cout << "4. ðŸ“‹ Transaction History" << endl;
            cout << "0. ðŸšª Logout" << endl;
            cout << "Choice: ";
            cin >> choice;

            double amount;
            switch (choice) {
                case 1:
                    cout << "ðŸ’° Deposit amount: Rs. ";
                    cin >> amount;
                    if (acc->deposit(amount)) 
                        cout << "âœ… Deposited successfully!" << endl;
                    else 
                        cout << "âŒ Deposit failed!" << endl;
                    break;
                    
                case 2:
                    cout << "ðŸ’¸ Withdraw amount: Rs. ";
                    cin >> amount;
                    if (acc->withdraw(amount)) 
                        cout << "âœ… Withdrawn successfully!" << endl;
                    else 
                        cout << "âŒ Withdrawal failed!" << endl;
                    break;
                    
                case 3: transfer(acc); break;
                case 4: acc->showTransactions(); break;
                case 0: cout << "ðŸ‘‹ Logged out!" << endl; break;
                default: cout << "âŒ Invalid choice!" << endl;
            }
        } while (choice != 0);
    }

private:
    void deleteAccount() {
        int no;
        cout << "ðŸ—‘ï¸ Account No to delete: ";
        cin >> no;
        
        auto it = remove_if(accounts.begin(), accounts.end(),
            [no](const BankAccount& acc) { return acc.getNo() == no; });
        accounts.erase(it, accounts.end());
        
        cout << "âœ… Account deleted!" << endl;
    }

    void listAllAccounts() const {
        cout << "\n=== ðŸ“Š ALL ACCOUNTS (" << accounts.size() << ") ===" << endl;
        for (const auto& acc : accounts) {
            cout << "No: " << acc.getNo() << " | " << acc.getName() 
                 << " | " << acc.getType() 
                 << " | Rs. " << fixed << setprecision(2) << acc.getBalance() << endl;
        }
    }

    void applyInterest() {
        double rate;
        cout << "ðŸ“ˆ Interest rate (%): ";
        cin >> rate;
        int count = 0;
        for (auto& acc : accounts) {
            if (acc.getType() == "Savings") {
                acc.addInterest(rate);
                count++;
            }
        }
        cout << "âœ… Interest applied to " << count << " Savings accounts!" << endl;
    }

    void transfer(BankAccount* from) {
        int toNo;
        double amount;
        cout << "âž¡ï¸ To Account No: ";
        cin >> toNo;
        cout << "ðŸ’° Amount: Rs. ";
        cin >> amount;

        BankAccount* to = findAccount(toNo);
        if (to && from->withdraw(amount)) {
            to->deposit(amount);
            cout << "âœ… Transfer successful!" << endl;
        } else {
            cout << "âŒ Transfer failed!" << endl;
        }
    }

    void saveAccounts() {
        ofstream out("bank_data.txt");
        for (const auto& acc : accounts) {
            out << acc.getNo() << "|" << acc.getName() << "|" 
                << "*****|" << acc.getType() << "|" 
                << fixed << setprecision(2) << acc.getBalance() << endl;
        }
        out.close();
    }
};

int main() {
    // ðŸ”¥ STUNNING PRESENTATION SCREEN - FIXED!
    showPresentation();
    
    Bank bank;
    int choice;

    do {
        cout << "\nðŸŽ¯ MAIN MENU" << endl;
        cout << "1. ðŸ‘¨â€ðŸ’¼ Admin Login" << endl;
        cout << "2. ðŸ‘¤ Customer Login" << endl;
        cout << "0. âŒ Exit" << endl;
        cout << "Choice: ";
        cin >> choice;

        switch (choice) {
            case 1: {
                string username, password;
                cout << "\nðŸ” Username: ";
                cin >> username;
                cout << "ðŸ” Password: ";
                cin.ignore();
                getline(cin, password);
                
                if (bank.adminLogin(username, password)) {
                    bank.adminMenu();
                } else {
                    cout << "âŒ Access Denied!" << endl;
                }
                break;
            }
            case 2:
                bank.customerMenu();
                break;
            case 0:
                cout << "\nðŸ‘‹ Thank you for using IBM Bank!" << endl;
                cout << "ðŸŽ“ Project by Arka Jain University Students" << endl;
                break;
            default:
                cout << "âŒ Invalid choice!" << endl;
        }
    } while (choice != 0);

    return 0;
}
